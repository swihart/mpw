<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>IPD version: Fay et al. (2026) supporting materials • mpw</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="IPD version: Fay et al. (2026) supporting materials">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mpw</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Exploratory approaches</h6></li>
    <li><a class="dropdown-item" href="../articles/alpha.html">Weibull-Weibull-Positive Stable</a></li>
    <li><a class="dropdown-item" href="../articles/beta.html">Burr-Weibull-Gamma</a></li>
    <li><a class="dropdown-item" href="../articles/lambda.html">Marginalized-Weibull-Inverse Gaussian</a></li>
    <li><a class="dropdown-item" href="../articles/rho.html">Marginalized-Weibull-Two Point (fixed mean 1)</a></li>
    <li><a class="dropdown-item" href="../articles/womega.html">Marginalized-Weibull-Two Point (unconstrained mean)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1-over-alpha approach</h6></li>
    <li><a class="dropdown-item" href="../articles/wwps-fay.html">Fay et al. (2025) supporting materials</a></li>
    <li><a class="dropdown-item" href="../articles/wwps-fay-ipd.html">IPD version: Fay et al. (2026) supporting materials</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Inferential approaches</h6></li>
    <li><a class="dropdown-item" href="../articles/womega.html">Marginalized-Weibull-Two Point (unconstrained mean)</a></li>
    <li><a class="dropdown-item" href="../articles/beta.html">Burr-Weibull-Gamma</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>IPD version: Fay et al. (2026) supporting materials</h1>
            <h3 data-toc-skip class="subtitle">IPD version</h3>
            
      

      <div class="d-none name"><code>wwps-fay-ipd.Rmd</code></div>
    </div>

    
    
<p>In Fay et al. (2026) <em>Vaccine Efficacy Estimands for Individual
Randomized Field Trials</em>, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mi>α</mi></mfrac><annotation encoding="application/x-tex">\frac{1}{\alpha}</annotation></semantics></math>
approach is used. In this approach which utilizes the
“Weibull-Weibull-Positive Stable” model, the population (marginal)
Weibull is estimated, and then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mi>α</mi></mfrac><annotation encoding="application/x-tex">\frac{1}{\alpha}</annotation></semantics></math>
is applied to those estimates to render the individual-level
(conditional) Weibull. This code recreates Figure 6 in that paper using
<code>mpw</code> calls.</p>
<p>The Weibull-Weibull-Positive Stable has a feature that the other mpw
frailty models do not have: that is, the marginal distribution (Weibull)
is the same as the conditional distribution (also Weibull). This enables
a strategy of estimating the mpw on the population data without
specifying an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
(this is done in practice by setting <code>alpha=1</code>) and then from
there one can exactly calculate corresponding conditional models (and
HRs, and VEs, etc) using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mi>α</mi></mfrac><annotation encoding="application/x-tex">\frac{1}{\alpha}</annotation></semantics></math>
applied to the <em>marginal</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
estimates.</p>
<p>Explicitly, the hazard ratio for an individual,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>I</mi></msub><annotation encoding="application/x-tex">\theta_I</annotation></semantics></math>,
can be produced by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><msubsup><mi>b</mi><mn>1</mn><mrow><mn>1</mn><mi>/</mi><mi>α</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>k</mi><mn>1</mn></msub><mi>/</mi><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>t</mi><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>k</mi><mn>1</mn></msub><mi>/</mi><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><mrow><msubsup><mi>b</mi><mn>0</mn><mrow><mn>1</mn><mi>/</mi><mi>α</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>k</mi><mn>0</mn></msub><mi>/</mi><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>t</mi><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>k</mi><mn>0</mn></msub><mi>/</mi><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mfrac><mo>=</mo><msub><mi>θ</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">\frac{ b_1^{1/\alpha} (k_1/\alpha) t^{(k_1/\alpha)-1}}{b_0^{1/\alpha} (k_0/\alpha) t^{(k_0/\alpha)-1}} = \theta_I</annotation></semantics></math></p>
<p>More details for the interested reader can be found in <a href="https://www.sciencedirect.com/science/article/pii/S0169260721001905?casa_token=xYzQZ9UfxGMAAAAA:vFpj08P43bUx_7BTN21cSUksK_WSyQdjIBhWHS7VG8u5ctGB91gDzE8-NJtMblcut67jD6k" class="external-link">Swihart
&amp; Bandyopadhyay (2021)</a>, particularly in Section 2.1.</p>
<div class="section level2">
<h2 id="positive-stable-frailty">Positive Stable Frailty<a class="anchor" aria-label="anchor" href="#positive-stable-frailty"></a>
</h2>
<p>This is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>α</mi></msub><annotation encoding="application/x-tex">F_{\alpha}</annotation></semantics></math>,
the marginalized piecewise Weibull CDF:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>α</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mo>exp</mo><mi>α</mi><mi>η</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">F_{\alpha}(x) = 1-\exp[-\exp\alpha\eta]</annotation></semantics></math></li>
</ul>
<p>The CDF above is the result of integrating a piecewise weibull
frailty model where the frailty has the
PS(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>,</mo><mi>α</mi><mo>,</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha,\alpha,0</annotation></semantics></math>)
Positive Stable Frailty density:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><msub><mi>u</mi><mi>i</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>u</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mfrac><mn>1</mn><mrow><mi>π</mi><msub><mi>u</mi><mi>i</mi></msub></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>∞</mi></msubsup><mfrac><mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mi>α</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>k</mi><mi>!</mi></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><msubsup><mi>u</mi><mi>i</mi><mrow><mo>−</mo><mi>α</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></msup><mo>sin</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mi>k</mi><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_{u_{i}}(u_{i} | \alpha) =  - \frac{1}{\pi u_{i}}  \sum_{k=1}^\infty \frac{\Gamma(k \alpha +1)}{k!}  (-u_{i}^{-\alpha})^k \sin{(\alpha k \pi)}</annotation></semantics></math></li>
</ul>
</div>
<div class="section level2">
<h2 id="ipd-data-from-a-km-curve">IPD data from a KM curve<a class="anchor" aria-label="anchor" href="#ipd-data-from-a-km-curve"></a>
</h2>
<p>We analyze data that looks similar to that of Figure 2 <a href="https://pubmed.ncbi.nlm.nih.gov/34525277/" class="external-link">Thomas et al (2021)
<em>Safety and Efficacy of the BNT162b2 mRNA Covid-19 Vaccine through 6
Months</em></a>.</p>
<p>We accomplished creating the Individual Patient Data (IPD) dataset in
this package, <code>ipd_data</code>, by using the R package
<code>IPDfromKM</code>. Feeding screen shots of the original Figure 2 <a href="https://pubmed.ncbi.nlm.nih.gov/34525277/" class="external-link">Thomas et al (2021)</a>
(rotated and flipped so that they looked like survival curves) into
<code>IPDfromKM</code>, and then using the point and click feature for
both the inset curve and the full curve for each group was how the IPD
data was generated. The results of this data are saved as
<code>ipd_data</code> in this package (mpw) and can be loaded and
analyzed, just as we do in this document.</p>
<p>Below, we load <code>ipd_data</code> and do a couple of quick checks
with <code>survminer</code> before proceeding with the core of our
example.</p>
<!-- We plot the data points, color-code the groups, and just connect the dots with interpolated, dashed lines. -->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/survminer/index.html" class="external-link">survminer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://swihart.github.io/mpw/">mpw</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## This data resembles Figure 2 in Thomas et al</span></span>
<span><span class="co">## https://pubmed.ncbi.nlm.nih.gov/34525277/</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ipd_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ipd_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 44939     3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ipd_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   time status treat</span></span>
<span><span class="co">#&gt; 1  0.5      0     0</span></span>
<span><span class="co">#&gt; 2  1.0      1     0</span></span>
<span><span class="co">#&gt; 3  1.0      1     0</span></span>
<span><span class="co">#&gt; 4  1.5      0     0</span></span>
<span><span class="co">#&gt; 5  1.5      0     0</span></span>
<span><span class="co">#&gt; 6  2.0      1     0</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>,</span>
<span>               data <span class="op">=</span> <span class="va">ipd_data</span><span class="op">)</span></span>
<span><span class="co">## zoomed in, inset, 11 days</span></span>
<span><span class="co"># Visualize with survminer</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html" class="external-link">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">ipd_data</span>, risk.table <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.993</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">28</span><span class="op">)</span>, break.time.by<span class="op">=</span><span class="fl">11</span>,</span>
<span>           fontsize<span class="op">=</span><span class="fl">2.7</span>,tables.height <span class="op">=</span> <span class="fl">0.350</span>,</span>
<span>           legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Placebo"</span>, <span class="st">"BNT162b2"</span><span class="op">)</span>,</span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#2E9FDF"</span>,<span class="st">"#FF4500"</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wwps-fay-ipd_files/figure-html/thomas-data-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Visualize with survminer</span></span>
<span><span class="co">## full view; every 14 days</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html" class="external-link">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">ipd_data</span>, risk.table <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.925</span><span class="op">)</span>, break.time.by<span class="op">=</span><span class="fl">14</span>,</span>
<span>           fontsize<span class="op">=</span><span class="fl">2.7</span>, tables.height <span class="op">=</span> <span class="fl">0.350</span>,</span>
<span>           legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Placebo"</span>, <span class="st">"BNT162b2"</span><span class="op">)</span>,</span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#2E9FDF"</span>,<span class="st">"#FF4500"</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wwps-fay-ipd_files/figure-html/thomas-data-2.png" class="r-plt" alt="" width="700"></p>
<p>In this exercise we use the functions of the mpw package. We begin by
setting the <code>h_parm</code> and <code>frailty</code> distribution
for this example. Beware that H_PARM has different bounds depending on
what value of FRAILTY is selected. For this positive-stable frailty
example, <code>FRAILTY &lt;- "PS"</code>, we are going to estimate the
marginal parameters first and can accomplish this setting
<code>H_PARM=1.00</code>, which will be passed to the argument
<code>h_parm</code> in the <code>mpw</code> function calls.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ALPHA_FIXED</span> <span class="op">&lt;-</span> <span class="va">H_PARM</span> <span class="op">&lt;-</span> <span class="fl">1.00</span></span>
<span><span class="va">FRAILTY</span> <span class="op">&lt;-</span> <span class="st">"PS"</span></span></code></pre></div>
<p>We set the first piece of each group to be equal so we can get an HR
of 1 (more in subsequent sections). This first piece can be specified to
be over a short time range where both groups would be considered equal
due to the <em>ramp-up time</em> of a vaccine. Below we set the ramp-up
time to end 1 day after first dose, the second piece to go from then to
28 days after the first dose, and the third piece from then 56 days
after the first dose, etc. The pieces are determined by the knots, which
we select in the next section to match up with the periods of time
listed in the Figure 2 of <a href="https://pubmed.ncbi.nlm.nih.gov/34525277/" class="external-link">Thomas et al
(2021)</a>.</p>
</div>
<div class="section level2">
<h2 id="knot-selection">Knot selection<a class="anchor" aria-label="anchor" href="#knot-selection"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tvec.in</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">28</span>,<span class="fl">56</span>,<span class="fl">84</span>,<span class="fl">112</span>,<span class="fl">140</span>,<span class="fl">168</span><span class="op">)</span></span>
<span><span class="va">tvec.in</span></span>
<span><span class="co">#&gt; [1]   1  28  56  84 112 140 168</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-the-likelihood-to-ipd-data">Fit the Likelihood to IPD data<a class="anchor" aria-label="anchor" href="#fit-the-likelihood-to-ipd-data"></a>
</h2>
<p>We set up the data objects from <code>ipd_data</code> which will
subsequently be used in the likelihood
<code>integrated_likelihood()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co">## the approach this script uses to build the likelihood</span></span>
<span><span class="co">## uses data.table</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">ipd_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ipd_data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">ipd_data</span><span class="op">)</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">ipd_data</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="va">status</span> <span class="op">&lt;-</span> <span class="va">ipd_data</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="va">ipd_data</span><span class="op">$</span><span class="va">treat</span></span>
<span><span class="va">one_minus_treat</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">treat</span></span>
<span></span>
<span><span class="co">## print the tvec.in (knots) selected:</span></span>
<span><span class="va">tvec.in</span></span>
<span><span class="co">#&gt; [1]   1  28  56  84 112 140 168</span></span>
<span><span class="va">LTVEC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tvec.in</span><span class="op">)</span></span>
<span><span class="va">LTVEC</span></span>
<span><span class="co">#&gt; [1] 7</span></span></code></pre></div>
<p>This is the likelihood that can be optimized using IPD data. This
approach is similar to Swihart &amp; Bandyopadhyay (2021).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## this approach is similar to Swihart &amp; Bandyopadhyay 2021</span></span>
<span><span class="va">integrated_likelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">parms</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">logk0</span>  <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span> <span class="fl">1</span><span class="op">]</span>; <span class="co"># shared shape (piece 1)</span></span>
<span>  <span class="va">g0</span>  <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span> <span class="fl">2</span><span class="op">]</span>; <span class="co"># shared scale (piece 1)</span></span>
<span>  <span class="va">delta_p</span> <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span> <span class="fl">3</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span><span class="op">+</span><span class="op">(</span><span class="va">LTVEC</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>;</span>
<span>  <span class="va">delta_v</span> <span class="op">&lt;-</span> <span class="va">parms</span><span class="op">[</span> <span class="op">(</span><span class="fl">3</span><span class="op">+</span><span class="va">LTVEC</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">LTVEC</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>;</span>
<span>  </span>
<span>  <span class="co">## use fast data.table to only compute if needed</span></span>
<span>  <span class="va">ipd_data</span><span class="op">[</span>, <span class="va">haz_p</span> <span class="op">:=</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">treat</span><span class="op">==</span><span class="fl">0</span>, </span>
<span>                    </span>
<span>                    <span class="fu"><a href="../reference/popavg_haz.html">popavg_haz</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                                     knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                                     logk0 <span class="op">=</span> <span class="va">logk0</span>,</span>
<span>                                     g0 <span class="op">=</span> <span class="va">g0</span>,</span>
<span>                                     delta_vec <span class="op">=</span> <span class="va">delta_p</span>,</span>
<span>                                     h_parm <span class="op">=</span> <span class="va">ALPHA_FIXED</span>,</span>
<span>                                     frailty <span class="op">=</span> <span class="st">"PS"</span><span class="op">)</span>,</span>
<span>                    <span class="fl">1</span><span class="op">)</span>,</span>
<span>           by<span class="op">=</span><span class="va">id</span></span>
<span>  <span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">ipd_data</span><span class="op">[</span>, <span class="va">haz_v</span> <span class="op">:=</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">treat</span><span class="op">==</span><span class="fl">1</span>, </span>
<span>                    </span>
<span>                    <span class="fu"><a href="../reference/popavg_haz.html">popavg_haz</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>                                     knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                                     logk0 <span class="op">=</span> <span class="va">logk0</span>,</span>
<span>                                     g0 <span class="op">=</span> <span class="va">g0</span>,</span>
<span>                                     delta_vec <span class="op">=</span> <span class="va">delta_v</span>,</span>
<span>                                     h_parm <span class="op">=</span> <span class="va">ALPHA_FIXED</span>,</span>
<span>                                     frailty <span class="op">=</span> <span class="st">"PS"</span><span class="op">)</span>,</span>
<span>                    <span class="fl">1</span><span class="op">)</span>,</span>
<span>           by<span class="op">=</span><span class="va">id</span></span>
<span>  <span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">ipd_data</span><span class="op">[</span>, <span class="va">surv_p</span> <span class="op">:=</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treat</span><span class="op">==</span><span class="fl">0</span>, </span>
<span>                    </span>
<span>                    <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="../reference/popavg_dist.html">popavg_dist</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                                         knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                                         logk0 <span class="op">=</span> <span class="va">logk0</span>,</span>
<span>                                         g0 <span class="op">=</span> <span class="va">g0</span>,</span>
<span>                                         delta_vec <span class="op">=</span> <span class="va">delta_p</span>,</span>
<span>                                         h_parm <span class="op">=</span> <span class="va">ALPHA_FIXED</span>,</span>
<span>                                         frailty <span class="op">=</span> <span class="st">"PS"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    <span class="fl">1</span><span class="op">)</span>,</span>
<span>           by<span class="op">=</span><span class="va">id</span></span>
<span>  <span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">ipd_data</span><span class="op">[</span>, <span class="va">surv_v</span> <span class="op">:=</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treat</span><span class="op">==</span><span class="fl">1</span>, </span>
<span>                    </span>
<span>                    <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="../reference/popavg_dist.html">popavg_dist</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                                         knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                                         logk0 <span class="op">=</span> <span class="va">logk0</span>,</span>
<span>                                         g0 <span class="op">=</span> <span class="va">g0</span>,</span>
<span>                                         delta_vec <span class="op">=</span> <span class="va">delta_v</span>,</span>
<span>                                         h_parm <span class="op">=</span> <span class="va">ALPHA_FIXED</span>,</span>
<span>                                         frailty <span class="op">=</span> <span class="st">"PS"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    <span class="fl">1</span><span class="op">)</span>,</span>
<span>           by<span class="op">=</span><span class="va">id</span></span>
<span>  <span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">ipd_data</span><span class="op">[</span>, <span class="va">likelihood_contribution</span><span class="op">:=</span><span class="va">surv_p</span><span class="op">*</span><span class="va">haz_p</span><span class="op">*</span><span class="va">surv_v</span><span class="op">*</span><span class="va">haz_v</span><span class="op">]</span></span>
<span>  <span class="va">k0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logk0</span><span class="op">)</span>;</span>
<span>  <span class="va">nll</span> <span class="op">&lt;-</span> </span>
<span>    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span></span>
<span>        <span class="va">ipd_data</span><span class="op">$</span><span class="va">likelihood_contribution</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="co">## penalize shapes less than 0 </span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">k0</span>,</span>
<span>          <span class="va">k0</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">delta_p</span><span class="op">)</span>,</span>
<span>          <span class="va">k0</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">delta_v</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e6</span></span>
<span></span>
<span>  <span class="va">nll</span>      </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="set-starting-values-and-test-one-evaluation-of-likelihood">set starting values and test one evaluation of likelihood<a class="anchor" aria-label="anchor" href="#set-starting-values-and-test-one-evaluation-of-likelihood"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## set the starting values for the optimization</span></span>
<span><span class="co">## the first two elements are for the first</span></span>
<span><span class="co">## (shared) piece; the 2nd row for the </span></span>
<span><span class="co">## deltas for one group</span></span>
<span><span class="co">## the 3rd row deltas for the other</span></span>
<span><span class="va">start_parms_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">0.6</span>, <span class="op">-</span><span class="fl">9.6</span>, <span class="co">## first piece (shared)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="va">LTVEC</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="va">LTVEC</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## test how long a computation of likelihood takes at starting values</span></span>
<span><span class="co">## one compuation?  takes a minute...</span></span>
<span><span class="va">beg.one.iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ilspv</span> <span class="op">&lt;-</span> <span class="fu">integrated_likelihood</span><span class="op">(</span><span class="va">start_parms_val</span><span class="op">)</span></span>
<span><span class="va">ilspv</span></span>
<span><span class="co">#&gt; [1] 37108.3</span></span>
<span><span class="va">end.one.iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dur.one.iter</span> <span class="op">&lt;-</span> <span class="va">end.one.iter</span> <span class="op">-</span> <span class="va">beg.one.iter</span></span>
<span><span class="va">dur.one.iter</span></span>
<span><span class="co">#&gt; Time difference of 1.818219 secs</span></span></code></pre></div>
<p>We include this code chunk below but do not run it (we saved its
output, accessed in the following chunk). We take the resultant
estimates from the <code>$par</code> to demonstrate our point.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## takes  7 min. w/o hess </span></span>
<span><span class="co">## takes 21 min with hess</span></span>
<span><span class="va">hess.true</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co">## calculate hessian (adds time)</span></span>
<span><span class="va">cis.true</span> <span class="op">&lt;-</span>  <span class="cn">FALSE</span> <span class="co">## given hess.true is TRUE, invert and calc CIs</span></span>
<span><span class="va">beg.all.iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Started at: "</span>, <span class="va">beg.all.iter</span><span class="op">)</span></span>
<span><span class="va">estimates_from_integrated_likelihood</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="va">start_parms_val</span>,</span>
<span>        <span class="va">integrated_likelihood</span>,</span>
<span>        method<span class="op">=</span><span class="st">"Nelder-Mead"</span>,</span>
<span>        control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">5000</span>, trace<span class="op">=</span><span class="fl">99</span>, reltol<span class="op">=</span><span class="fl">1e-5</span><span class="op">)</span>,</span>
<span>        hessian <span class="op">=</span> <span class="va">hess.true</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">end.all.iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dur.all.iter</span> <span class="op">&lt;-</span> <span class="va">end.all.iter</span> <span class="op">-</span> <span class="va">beg.all.iter</span></span>
<span><span class="va">dur.all.iter</span></span></code></pre></div>
<!-- Here's the saved object: -->
<p>Here the starting and the estimated parameters side by side:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">start_parms_val</span>,</span>
<span>      <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;       start_parms_val            </span></span>
<span><span class="co">#&gt;  [1,]            0.60  0.15235330</span></span>
<span><span class="co">#&gt;  [2,]           -9.60 -9.29170555</span></span>
<span><span class="co">#&gt;  [3,]            0.01  0.10689143</span></span>
<span><span class="co">#&gt;  [4,]            0.01 -0.13605960</span></span>
<span><span class="co">#&gt;  [5,]            0.01  0.16851153</span></span>
<span><span class="co">#&gt;  [6,]            0.01  0.21571090</span></span>
<span><span class="co">#&gt;  [7,]            0.01 -0.08127181</span></span>
<span><span class="co">#&gt;  [8,]            0.01 -0.31537088</span></span>
<span><span class="co">#&gt;  [9,]            0.01 -0.23671255</span></span>
<span><span class="co">#&gt; [10,]            0.00 -0.20730928</span></span>
<span><span class="co">#&gt; [11,]            0.00 -0.86707665</span></span>
<span><span class="co">#&gt; [12,]            0.00  0.41859629</span></span>
<span><span class="co">#&gt; [13,]            0.00  0.31871958</span></span>
<span><span class="co">#&gt; [14,]            0.00  0.56142307</span></span>
<span><span class="co">#&gt; [15,]            0.00  0.26444126</span></span>
<span><span class="co">#&gt; [16,]            0.00  0.50404189</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-for-the-placebo-group">Fit for the placebo group<a class="anchor" aria-label="anchor" href="#fit-for-the-placebo-group"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># starting values:</span></span>
<span><span class="co"># logk0p = start_parms_val[1]</span></span>
<span><span class="co"># g0p = start_parms_val[2]</span></span>
<span><span class="co"># delta_vec_p = start_parms_val[ 3:(3+(LTVEC-1))]</span></span>
<span></span>
<span><span class="co"># estimated values:</span></span>
<span><span class="va">logk0p</span> <span class="op">=</span> <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">g0p</span> <span class="op">=</span> <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">delta_vec_p</span> <span class="op">=</span> <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span><span class="op">[</span> <span class="fl">3</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span><span class="op">+</span><span class="op">(</span><span class="va">LTVEC</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-for-vaccine-group">Fit for vaccine group<a class="anchor" aria-label="anchor" href="#fit-for-vaccine-group"></a>
</h2>
<p>Notice <code>logk0p</code>=<code>logk0v</code> and
<code>g0p</code>=<code>g0v</code>, the parameters that control the first
(leftmost) piece for the placebo group (p) and the vaccine group (v).
This parameterization forces the first pieces to be the same for both
groups (i.e. <em>ramp-up time</em>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># starting values:</span></span>
<span><span class="co"># logk0v = start_parms_val[1]</span></span>
<span><span class="co"># g0v = start_parms_val[2]</span></span>
<span><span class="co"># delta_vec_v = start_parms_val[ (3+LTVEC):(2*LTVEC+2)]</span></span>
<span></span>
<span><span class="co"># estimated values:</span></span>
<span><span class="va">logk0v</span> <span class="op">=</span> <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">g0v</span> <span class="op">=</span> <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">delta_vec_v</span> <span class="op">=</span> <span class="va">estimates_from_integrated_likelihood</span><span class="op">$</span><span class="va">par</span><span class="op">[</span> <span class="op">(</span><span class="fl">3</span><span class="op">+</span><span class="va">LTVEC</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">LTVEC</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-population-avg-cdf">Plot population avg CDF<a class="anchor" aria-label="anchor" href="#plot-population-avg-cdf"></a>
</h2>
<ul>
<li>Quick check of fit</li>
</ul>
<p>We use the knots and the original time in <code>time.dist</code> to
do a quick check of the fit. We put vertical dashed lines in the plot to
denote knot placement.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">tvec.in</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">tvec.in</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                    <span class="va">tvec.in</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="va">plac.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popavg_dist.html">popavg_dist</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time.dist</span>, </span>
<span>                           knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                           logk0 <span class="op">=</span> <span class="va">logk0p</span>,</span>
<span>                              g0 <span class="op">=</span> <span class="va">g0p</span>,</span>
<span>                       delta_vec <span class="op">=</span> <span class="va">delta_vec_p</span>,</span>
<span>                          h_parm <span class="op">=</span> <span class="va">H_PARM</span>,</span>
<span>                         frailty <span class="op">=</span> <span class="va">FRAILTY</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vacc.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popavg_dist.html">popavg_dist</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time.dist</span>, </span>
<span>                           knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                           logk0 <span class="op">=</span> <span class="va">logk0v</span>,</span>
<span>                              g0 <span class="op">=</span> <span class="va">g0v</span>,</span>
<span>                       delta_vec <span class="op">=</span> <span class="va">delta_vec_v</span>,</span>
<span>                          h_parm <span class="op">=</span> <span class="va">H_PARM</span>,</span>
<span>                         frailty <span class="op">=</span> <span class="va">FRAILTY</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span>  <span class="op">(</span><span class="va">time.dist</span>, <span class="va">plac.dist</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"#2E9FDF"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.08</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"Cumulative Incidence"</span>,xlab<span class="op">=</span><span class="st">"Day since Receipt of First Dose"</span>, </span>
<span>        main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Specified Knots: "</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tvec.in</span>,<span class="fl">1</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">time_plac</span>     , <span class="va">F0</span>       , col<span class="op">=</span><span class="st">"#2E9FDF"</span>, pch<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span> <span class="op">(</span><span class="va">time.dist</span>, <span class="va">vacc.dist</span>, col<span class="op">=</span><span class="st">"#FF4500"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">time_vacc</span>     , <span class="va">F1</span>, col<span class="op">=</span><span class="st">"#FF4500"</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">tvec.in</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Placebo"</span>, <span class="st">"BNT162b2"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#2E9FDF"</span>,<span class="st">"#FF4500"</span><span class="op">)</span>,</span>
<span>       lty<span class="op">=</span><span class="fl">1</span>,</span>
<span>       pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">16</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tvec.in</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wwps-fay-ipd_files/figure-html/alpha-02-knots-popavg-dist-1.png" class="r-plt" alt="" width="700"></p>
<!-- Note from Days 0 to 1 the curves are the same. Over this range the HR will be 1.  Additionally, the fit looks okay -- some points are below their line and some are above. -->
<p>Note from Days 0 to 1 the curves are the same. Over this range the HR
will be 1. Additionally, the fit looks okay – some points are below
their line and some are above.</p>
</div>
<div class="section level2">
<h2 id="plot-population-avg-hr">Plot population avg HR<a class="anchor" aria-label="anchor" href="#plot-population-avg-hr"></a>
</h2>
<ul>
<li>uses parameters from two step fitting procedure</li>
<li>HR(0) = 1</li>
</ul>
<p>We use the parameters of the previous fits to estimate the population
average hazard, which we can fit with <code><a href="../reference/popavg_haz.html">mpw::popavg_haz()</a></code>. We
adjust the time input so that the first element is just above 0.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time.haz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-4</span>, <span class="va">time.dist</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">plac.haz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popavg_haz.html">popavg_haz</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time.haz</span>, </span>
<span>                           knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                           logk0 <span class="op">=</span> <span class="va">logk0p</span>,</span>
<span>                              g0 <span class="op">=</span> <span class="va">g0p</span>,</span>
<span>                       delta_vec <span class="op">=</span> <span class="va">delta_vec_p</span>,</span>
<span>                          h_parm <span class="op">=</span> <span class="va">H_PARM</span>,</span>
<span>                         frailty <span class="op">=</span> <span class="va">FRAILTY</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vacc.haz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popavg_haz.html">popavg_haz</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time.haz</span>, </span>
<span>                           knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                           logk0 <span class="op">=</span> <span class="va">logk0v</span>,</span>
<span>                              g0 <span class="op">=</span> <span class="va">g0v</span>,</span>
<span>                       delta_vec <span class="op">=</span> <span class="va">delta_vec_v</span>,</span>
<span>                          h_parm <span class="op">=</span> <span class="va">H_PARM</span>,</span>
<span>                         frailty <span class="op">=</span> <span class="va">FRAILTY</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span>  <span class="op">(</span><span class="va">time.haz</span>, <span class="va">vacc.haz</span><span class="op">/</span><span class="va">plac.haz</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"purple"</span>, xlab<span class="op">=</span><span class="st">"Days"</span>,</span>
<span>       ylab<span class="op">=</span><span class="st">"Hazard Ratio"</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">1.05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">tvec.in</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tvec.in</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wwps-fay-ipd_files/figure-html/alpha-02-knots-popavg-haz-1.png" class="r-plt" alt="" width="700"></p>
<p>Or, plot the VE = 1-HR:</p>
</div>
<div class="section level2">
<h2 id="plot-population-avg-ve1-hr">Plot population avg VE=1-HR<a class="anchor" aria-label="anchor" href="#plot-population-avg-ve1-hr"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span>  <span class="op">(</span><span class="va">time.haz</span>, <span class="fl">1</span><span class="op">-</span><span class="va">vacc.haz</span><span class="op">/</span><span class="va">plac.haz</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"purple"</span>, xlab<span class="op">=</span><span class="st">"Days"</span>,</span>
<span>       ylab<span class="op">=</span><span class="st">"Vaccine Efficacy"</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">1.05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">tvec.in</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tvec.in</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="wwps-fay-ipd_files/figure-html/alpha-02-knots-popavg-ve-1.png" class="r-plt" alt="" width="700"></p>
<p>A nice feature of this analysis is that we can surmise the
heterogeneity and make a point in the next section.</p>
</div>
<div class="section level2">
<h2 id="plot-subject-specific-ves-for-different-alpha-values">Plot subject-specific VEs for different alpha values<a class="anchor" aria-label="anchor" href="#plot-subject-specific-ves-for-different-alpha-values"></a>
</h2>
<ul>
<li>The VE should flatten to 1 as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha \rightarrow 0</annotation></semantics></math>
</li>
</ul>
<p>In other articles on this website demonstrating <code>mpw</code> use
cases, adding subject specific curves involves the
<code><a href="../reference/subjspec_haz.html">mpw::subjspec_haz()</a></code> function. In the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mi>α</mi></mfrac><annotation encoding="application/x-tex">\frac{1}{\alpha}</annotation></semantics></math>
approach, we instead use <code><a href="../reference/popavg_haz.html">mpw::popavg_haz()</a></code> specifying
h_parm as 1/alpha to plot the subject specific curve.</p>
<!-- Sidenote: This is because the function `mpw::subjspec_haz()` does not require the arguments `frailty` or `h_parm`. The function takes the inputs for the b,k, and delta pieces and models the subject-specific (aka conditional) hazard assuming they were estimated in the presence of a non-unity `h_parm`. -->
<p>To demonstrate how the individual-level VE might be different than
the population-level, the code below runs a loop for three specific
values of alpha:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">COL</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">LTY</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">LWD</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"#2E9FDF"</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">VE</span><span class="op">[</span><span class="va">h</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"Days since Receipt of First Dose"</span>, main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Specified knots: "</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tvec.in</span>,<span class="fl">1</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##set alpha.vec here to plot different conditionals</span></span>
<span><span class="va">alpha.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.7</span>,<span class="fl">0.99</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## now plot</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">alpha.vec</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">a.in</span> <span class="op">&lt;-</span> <span class="va">alpha.vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span><span class="va">plac.haz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popavg_haz.html">popavg_haz</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time.haz</span>, </span>
<span>                           knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                           logk0 <span class="op">=</span> <span class="va">logk0p</span>,</span>
<span>                              g0 <span class="op">=</span> <span class="va">g0p</span>,</span>
<span>                       delta_vec <span class="op">=</span> <span class="va">delta_vec_p</span>,</span>
<span>                          h_parm <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">a.in</span>,</span>
<span>                         frailty <span class="op">=</span> <span class="va">FRAILTY</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vacc.haz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popavg_haz.html">popavg_haz</a></span><span class="op">(</span>      x <span class="op">=</span> <span class="va">time.haz</span>, </span>
<span>                           knots <span class="op">=</span> <span class="va">tvec.in</span>,</span>
<span>                           logk0 <span class="op">=</span> <span class="va">logk0v</span>,</span>
<span>                              g0 <span class="op">=</span> <span class="va">g0v</span>,</span>
<span>                       delta_vec <span class="op">=</span> <span class="va">delta_vec_v</span>,</span>
<span>                          h_parm <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">a.in</span>,</span>
<span>                         frailty <span class="op">=</span> <span class="va">FRAILTY</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">time.haz</span>, <span class="fl">1</span><span class="op">-</span><span class="va">vacc.haz</span><span class="op">/</span><span class="va">plac.haz</span>, col<span class="op">=</span><span class="va">COL</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,lty<span class="op">=</span><span class="va">LTY</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,lwd<span class="op">=</span><span class="va">LWD</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">tvec.in</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alpha="</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.40"</span>,<span class="st">"0.70"</span>,<span class="st">"0.99"</span><span class="op">)</span><span class="op">)</span>,lty<span class="op">=</span><span class="va">LTY</span>,lwd<span class="op">=</span><span class="va">LWD</span>,col<span class="op">=</span><span class="va">COL</span><span class="op">)</span></span></code></pre></div>
<p><img src="wwps-fay-ipd_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" alt="" width="700"></p>
<!-- The plot above shows that for a positive-stable frailty, as $\alpha$ goes to 0 the subject-specific VE is flatter, approaching VE=1.  Going the opposite direction, as $\alpha$ goes to 1 the VE for an individual approaches that of the population VE.  Conceptually, one might conclude VE is waning over time if alpha is 0.99.  One would not conclude that if alpha was 0.40.  **In both instances, the same population-level VE would be observed.**  Therefore the takeaway is to not make statements about VE looking at population-level curves. -->
<p>The plot above shows that for a positive-stable frailty, as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
goes to 0 the subject-specific VE is flatter, approaching VE=1. Going
the opposite direction, as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
goes to 1 the VE for an individual approaches that of the population VE.
Under the model with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.99</mn></mrow><annotation encoding="application/x-tex">\alpha=0.99</annotation></semantics></math>,
the individual-level VE is waning over time, but under the model with
alpha=0.40, the individual-level VE appears relatively constant over
time. In both instances, the same population-level VE would be observed.
Therefore the takeaway is to not make statements about individual-level
VE looking at population-level curves.</p>
</div>
<div class="section level2">
<h2 id="example-code-calculate-ve-ci-and-ve-ch">Example code: Calculate VE-CI and VE-CH<a class="anchor" aria-label="anchor" href="#example-code-calculate-ve-ci-and-ve-ch"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## (using IPD data) </span></span>
<span><span class="co">## warning: this will overwrite F0 and F1 vectors</span></span>
<span><span class="op">(</span><span class="va">F0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">plac.dist</span><span class="op">[</span><span class="va">time.dist</span><span class="op">==</span><span class="fl">182</span><span class="op">]</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.065</span></span>
<span><span class="op">(</span><span class="va">F1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">vacc.dist</span><span class="op">[</span><span class="va">time.dist</span><span class="op">==</span><span class="fl">182</span><span class="op">]</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.008</span></span>
<span></span>
<span><span class="co"># use vectors from above</span></span>
<span><span class="va">S0</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">F0</span></span>
<span><span class="va">S1</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">F1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ve_ch</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">S1</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">S0</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.88</span></span>
<span></span>
<span><span class="va">theta_odds</span> <span class="op">&lt;-</span> <span class="va">F1</span><span class="op">/</span><span class="va">F0</span> <span class="op">*</span> <span class="op">(</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">F0</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">F1</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">theta_ci</span> <span class="op">&lt;-</span> <span class="va">theta_odds</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">F0</span><span class="op">+</span><span class="va">theta_odds</span><span class="op">*</span><span class="va">F0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ve_ci</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">theta_ci</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.877</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bruce Swihart.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
